%!TEX root = paper.tex
\newcommand{\reduce}[1]{\ensuremath{\rightarrow_{#1}}}

\newsavebox{\syncZero}
\begin{lrbox}{\syncZero}
\begin{minipage}[t]{0.6\linewidth}
\large
\begin{alltt}
\(ss\sb{0}(from p\sb{1}, to p\sb{3})\)
\(s\sb{1}(from p\sb{1}, to p\sb{2})\)
\end{alltt}
\end{minipage}
\end{lrbox}

\newsavebox{\syncOne}
\begin{lrbox}{\syncOne}
\begin{minipage}[t]{0.6\linewidth}
\large
\begin{alltt}
\(r\sb{0}(from p\sb{1}, to p\sb{2})\)
\(s\sb{2}(from p\sb{2}, to p\sb{3})\)
\end{alltt}
\end{minipage}
\end{lrbox}

\newsavebox{\syncTwo}
\begin{lrbox}{\syncTwo}
\begin{minipage}[t]{0.6\linewidth}
\large
\begin{alltt}
\(r\sb{1}(from p\sb{2}, to p\sb{3})\)
\(r\sb{2}(from \ast, to p\sb{3})\)
\end{alltt}
\end{minipage}
\end{lrbox}


\newcommand\syncexample{
\begin{figure*}[tb]
\begin{center}
\setlength{\tabcolsep}{2pt}
\begin{tabular}[t]{c|c|c}
$\mathit{p_1}$ & $\mathit{p_2}$ & $\mathit{p_3}$ \\
\hline
\scalebox{0.8}{\usebox{\syncZero}}&
\scalebox{0.8}{\usebox{\syncOne}} &
\scalebox{0.8}{\usebox{\syncTwo}}
\end{tabular}
\end{center}
\caption{A simple concurrent trace program with synchronous send.}
\label{fig:syncexample}
\end{figure*}
}

\newsavebox{\readyZero}
\begin{lrbox}{\readyZero}
\begin{minipage}[t]{0.6\linewidth}
\large
\begin{alltt}
\(r\sb{0}(from \ast, to p\sb{1})\)
\(r\sb{1}(from \ast, to p\sb{1})\)
\(r\sb{2}(from p\sb{2}, to p\sb{1})\)
\(s\sb{5}(from p\sb{1}, to p\sb{2})\)
\(r\sb{3}(from \ast, to p\sb{1})\)
\(r\sb{4}(from \ast, to p\sb{1})\)
\end{alltt}
\end{minipage}
\end{lrbox}

\newsavebox{\readyOne}
\begin{lrbox}{\readyOne}
\begin{minipage}[t]{0.6\linewidth}
\large
\begin{alltt}
\(s\sb{0}(from p\sb{2}, to p\sb{1})\)
\(rs\sb{1}(from p\sb{2}, to p\sb{1})\)
\(r\sb{5}(from p\sb{1}, to p\sb{2})\)
\(s\sb{2}(from p\sb{2}, to p\sb{1})\)
\end{alltt}
\end{minipage}
\end{lrbox}

\newsavebox{\readyTwo}
\begin{lrbox}{\readyTwo}
\begin{minipage}[t]{0.6\linewidth}
\large
\begin{alltt}
\(s\sb{3}(from p\sb{3}, to p\sb{1})\)
\(s\sb{4}(from p\sb{3}, to p\sb{1})\)
\end{alltt}
\end{minipage}
\end{lrbox}


\newcommand\readyexample{
\begin{figure*}[tb]
\begin{center}
\setlength{\tabcolsep}{2pt}
\begin{tabular}[t]{c|c|c}
$\mathit{p_1}$ & $\mathit{p_2}$ & $\mathit{p_3}$ \\
\hline
\scalebox{0.8}{\usebox{\readyZero}}&
\scalebox{0.8}{\usebox{\readyOne}} &
\scalebox{0.8}{\usebox{\readyTwo}}
\end{tabular}
\end{center}
\caption{A simple concurrent trace program with ready send.}
\label{fig:readyexample}
\end{figure*}
}






\newsavebox{\boxTZero}
\begin{lrbox}{\boxTZero}
\begin{minipage}[t]{0.6\linewidth}
\large
\begin{alltt}
\(r\sb{0}(from \ast, to p\sb{1}, w\sb{0})\)
\(w\sb{0}(r\sb{0})\)
\(r\sb{1}(from \ast, to p\sb{1}, w\sb{1})\)
\(w\sb{1}(r\sb{1})\)
\(r\sb{2}(from p\sb{2}, to p\sb{1}, w\sb{2})\)
\(w\sb{2}(r\sb{2})\)
\(s\sb{5}(from p\sb{1}, to p\sb{2})\)
\(r\sb{3}(from \ast, to p\sb{1}, w\sb{3})\)
\(w\sb{3}(r\sb{3})\)
\(r\sb{4}(from \ast, to p\sb{1}, w\sb{4})\)
\(w\sb{4}(r\sb{4})\)
\end{alltt}
\end{minipage}
\end{lrbox}

\newsavebox{\boxTOne}
\begin{lrbox}{\boxTOne}
\begin{minipage}[t]{0.6\linewidth}
\large
\begin{alltt}
\(s\sb{0}(from p\sb{2}, to p\sb{1})\)
\(s\sb{1}(from p\sb{2}, to p\sb{1})\)
\(r\sb{5}(from p\sb{1}, to p\sb{2}, w\sb{5})\)
\(w\sb{5}(r\sb{5})\)
\(s\sb{2}(from p\sb{2}, to p\sb{1})\)
\end{alltt}
\end{minipage}
\end{lrbox}

\newsavebox{\boxTTwo}
\begin{lrbox}{\boxTTwo}
\begin{minipage}[t]{0.6\linewidth}
\large
\begin{alltt}
\(s\sb{3}(from p\sb{3}, to p\sb{1})\)
\(s\sb{4}(from p\sb{3}, to p\sb{1})\)
\end{alltt}
\end{minipage}
\end{lrbox}

% ---------------------------------------------------------------------
% END Save boxes
% ---------------------------------------------------------------------

\newcommand\examplefigone{
\begin{figure*}[tb]
\begin{center}
\setlength{\tabcolsep}{2pt}
\begin{tabular}[t]{c|c|c}
$\mathit{p_1}$ & $\mathit{p_2}$ & $\mathit{p_3}$ \\
\hline
\scalebox{0.8}{\usebox{\boxTZero}}&
\scalebox{0.8}{\usebox{\boxTOne}} &
\scalebox{0.8}{\usebox{\boxTTwo}}
\end{tabular}
\end{center}
\caption{A simple concurrent trace program.}
\label{fig:example}
\end{figure*}
}

\newsavebox{\TemplateboxTZero}
\begin{lrbox}{\TemplateboxTZero}
\begin{minipage}[t]{0.4\linewidth}
\large
\begin{alltt}
\(r\sb{0}(from \ast, to p\sb{r}, w\sb{0})\)
\(w\sb{0}(r\sb{0})\)
\(r\sb{1}(from \ast, to p\sb{r}, w\sb{1})\)
\(w\sb{1}(r\sb{1})\)
\ldots
\end{alltt}
\end{minipage}
\end{lrbox}

\newsavebox{\TemplateboxTOne}
\begin{lrbox}{\TemplateboxTOne}
\begin{minipage}[t]{0.35\linewidth}
\large
\begin{alltt}
\(s\sb{0}(from p\sb{1}, to p\sb{r})\)
\(s\sb{1}(from p\sb{1}, to p\sb{r})\)
\ldots
\end{alltt}
\end{minipage}
\end{lrbox}

\newsavebox{\TemplateboxTTwo}
\begin{lrbox}{\TemplateboxTTwo}
\begin{minipage}[t]{0.05\linewidth}
\large
\begin{alltt}
\ldots
\end{alltt}
\end{minipage}
\end{lrbox}

\newsavebox{\TemplateboxTThree}
\begin{lrbox}{\TemplateboxTThree}
\begin{minipage}[t]{0.35\linewidth}
\large
\begin{alltt}
\(s\sb{m0}(from p\sb{m}, to p\sb{r})\)
\(s\sb{m1}(from p\sb{m}, to p\sb{r})\)
\ldots
\end{alltt}
\end{minipage}
\end{lrbox}

\newcommand\examplefigtemplate{
\begin{figure*}[tb]
\begin{center}
\setlength{\tabcolsep}{2pt}
\begin{tabular}[t]{c|c|c|c}
$\mathit{p_r}$ & $\mathit{p_1}$ & $\ldots$ &$\mathit{p_m}$ \\
\hline
\scalebox{0.75}{\usebox{\TemplateboxTZero}}&
\scalebox{0.75}{\usebox{\TemplateboxTOne}} &
\scalebox{0.75}{\usebox{\TemplateboxTTwo}} &
\scalebox{0.75}{\usebox{\TemplateboxTThree}}

\end{tabular}
\end{center}
\caption{A template concurrent trace prorgam.}
\label{fig:Texample}
\end{figure*}
}


\newcommand\encodingptp{
\begin{figure*}[t]
\begin{alignat}{6}
-&
\begin{aligned}[t]
&\text{Sequential sends}\, \mathtt{s}\, \text{and}\, \mathtt{s^\prime}\, \text{from a common}\\
&\text{source to a common destination}\, e_\mathtt{s} = e_\mathtt{s^\prime}
\end{aligned}
\qquad && \mathit{time}_\mathtt{s} \prec_\mathtt{HB} \mathit{time}_\mathtt{s^\prime}\\
-&
\begin{aligned}[t] 
&\text{Sequential receives}\, \mathtt{r}\, \text{and}\, \mathtt{r^\prime},\, \text{on a common}\\
&\text{process},\, e_\mathtt{r} = e_\mathtt{r^\prime}
\end{aligned}
\qquad && \mathit{time}_\mathtt{r} \prec_\mathtt{HB} \mathit{time}_\mathtt{r^\prime}\\
-&\text{Receive \texttt{r} and its nearest-enclosing wait}\, \mathtt{w}_\mathtt{r} 
\qquad && \mathit{time}_\mathtt{r} \prec_\mathtt{HB} \mathit{time}_{\mathtt{w}_\mathtt{r}}\\
-&
\begin{aligned}[t]
&\text{Sequential order over a nearest-enclosing} \\
&\text{wait}\, \mathtt{w}_\mathtt{r}\, \text{for a receive \texttt{r} and a send \texttt{s}}
\end{aligned}
\qquad && \mathit{time}_{\mathtt{w}_\mathtt{r}} \prec_\mathtt{HB} \mathit{time}_\mathtt{s}\\
-&
\begin{aligned}[t]
&\text{Two Sends, \texttt{s} and}\, \mathtt{s^\prime},\, \text{to a common destination},\\
&e_{\mathtt{s}}=e_{\mathtt{s^\prime}},\, \text{such that}\,  \mathit{time}_\mathtt{s}\ \mathrm{\prec_\mathtt{HB}}\ \mathit{time}_\mathtt{s^\prime}\, \text{is enforced}
\end{aligned}
\qquad&&M_{\mathtt{s}}\ \mathrm{\prec_{\mathtt{HB}}}\ M_{\mathtt{s^\prime}}\\
-&\text{Match pairs for any receive \texttt{r}} \qquad &&  \bigvee_{\mathtt{s} \in \mathrm{Match}(\mathtt{r})} \langle\mathtt{r},\mathtt{s}\rangle
\end{alignat}
\caption{SMT encoding for MPI point-to-point communication.}
\label{fig:ptp}
\end{figure*}
}

\newcommand\encodingsync{
\begin{figure*}[t]
\begin{alignat}{2}
-&\text{Synchronous send \texttt{ss} and its nearest-enclosing wait}\, \mathtt{w}_\mathtt{ss} 
\qquad && \mathit{time}_\mathtt{ss} \prec_\mathtt{HB} \mathit{time}_{\mathtt{w}_\mathtt{ss}}\\
-&
\begin{aligned}[t]
&\text{Match pair,}\, \langle \mathtt{r},\mathtt{ss}\rangle, \mathtt{w}\, \text{is the nearest-enclosing wait for \texttt{ss}}
\end{aligned}
\qquad&&\mathit{time}_\mathtt{r}\ \mathrm{\prec_{\mathtt{HB}}}\ \mathit{time}_\mathtt{w}
\end{alignat}
\caption{SMT encoding for MPI synchronous send.}
\label{fig:syncrule}
\end{figure*}
}


\newcommand\encodingready{
\begin{figure*}[t]
\begin{alignat}{2}
-&\text{Match pairs for any ready send \texttt{rs}}
\qquad&&\bigvee_{\mathtt{rs}\in \mathtt{S},\mathtt{r}\in \mathtt{Match}(\mathtt{rs})}\mathit{time}_\mathtt{rs}\ \mathrm{\prec_{\mathtt{HB}}}\ \mathit{time}_\mathtt{r}
\end{alignat}
\caption{Program property for MPI ready send.}
\label{fig:readyrule}
\end{figure*}
}





